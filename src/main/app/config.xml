<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p" 
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">


	    
    
<!--     <spring:beans>
     	<spring:bean id="jedisConnFactory" name="jedisConnFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" 
        	p:host-name="${redis.host}" p:port="${redis.port}"/>
        
        <spring:bean id="stringRedisSerializer" class="org.springframework.data.redis.serializer.StringRedisSerializer"/>
    
        <spring:bean id="redisTemplate" name="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"  p:keySerializer-ref="stringRedisSerializer" lazy-init="false">
            <spring:property name="connectionFactory" ref="jedisConnFactory"/>
            <spring:property name="valueSerializer">
                <spring:bean class="org.springframework.data.redis.serializer.JacksonJsonRedisSerializer">
                    <spring:constructor-arg type="java.lang.Class" value="java.lang.Object"/>
                </spring:bean>
            </spring:property>
        </spring:bean>
    
        <spring:bean id="cacheManager" name="cacheManager" class="org.springframework.data.redis.cache.RedisCacheManager">
            <spring:constructor-arg ref="redisTemplate"/>
        </spring:bean>
    </spring:beans> -->

	<spring:beans>
 
		<spring:bean id="jedisConnFactory" class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory">
	        <spring:constructor-arg  ref="redisSentinelConfiguration" />
	         <!-- <spring:constructor-arg ref="redisSentinelConfiguration2" /> -->
	        <spring:constructor-arg ref="jedisPoolConfig" />
	    </spring:bean>
	           
      <spring:bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig">
	       <spring:property name="maxTotal" value="${redis.maxTotal}" />
	       <spring:property name="maxIdle" value="${redis.maxIdle}" />
	       <spring:property name="minIdle" value="${redis.minIdle}" />
	       <spring:property name="maxWaitMillis" value="${redis.maxWaitMillis}" />
	       <spring:property name="testOnBorrow" value="${redis.testOnBorrow}" />
    	</spring:bean>

		 
		<spring:bean id="redisSentinelConfiguration" class="org.springframework.data.redis.connection.RedisSentinelConfiguration" name="Bean">
	        <spring:constructor-arg name="master" value="${redis.master}" />
	        <spring:constructor-arg name="sentinelHostAndPorts">
	        	<spring:set>
	                <spring:value>${redis.sentinel}</spring:value>
	            </spring:set>
	        </spring:constructor-arg>
    	</spring:bean>
    	
    	
		<spring:bean id="redisSentinelConfiguration2" class="org.springframework.data.redis.connection.RedisSentinelConfiguration" name="Bean2">
	        <spring:constructor-arg name="master" value="${redis.master}" />
	        <spring:constructor-arg name="sentinelHostAndPorts">
	        	<spring:set>
	                <spring:value>${redis.sentinel.2}</spring:value>
	            </spring:set>
	        </spring:constructor-arg>
    	</spring:bean>
    	

		<spring:bean id="stringRedisSerializer" class="org.springframework.data.redis.serializer.StringRedisSerializer"/>

	    <spring:bean id="redisTemplate" name="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate"  p:keySerializer-ref="stringRedisSerializer" lazy-init="false">
            <spring:property name="connectionFactory" ref="jedisConnFactory"/>
            <spring:property name="valueSerializer">
                <spring:bean class="org.springframework.data.redis.serializer.JacksonJsonRedisSerializer">
                    <spring:constructor-arg type="java.lang.Class" value="java.lang.Object"/>
                </spring:bean>
            </spring:property>
        </spring:bean>
    
        <spring:bean id="cacheManager" name="cacheManager" class="org.springframework.data.redis.cache.RedisCacheManager">
            <spring:constructor-arg ref="redisTemplate"/>
        </spring:bean>
        
        <spring:bean id="redisCache" class="java.lang.Integer" factory-method="valueOf">
		    <spring:constructor-arg value="${redis.cache.age}" />
		</spring:bean>

      <!--   
   		<spring:bean id="JedisSentinelPool" class="redis.clients.jedis.JedisSentinelPool">
			<spring:constructor-arg index="0" value="redis-cluster" />
			<spring:constructor-arg index="1">
			     <spring:set>  
			         <spring:value>localhost:80</spring:value>  
			    </spring:set> 
			</spring:constructor-arg>
			<spring:constructor-arg index="2" ref="jedisPoolConfig"/>
		</spring:bean> -->
		

    </spring:beans>
	 	
	 	
</mule>
